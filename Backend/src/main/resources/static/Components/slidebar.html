<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sidebar BiblioGest</title>
  <!-- SweetAlert2 para los modales de confirmaci√≥n -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="../css/slide-styles.css">
</head>
<body>

<!-- Overlay oscuro para cerrar el sidebar en m√≥vil -->
<div id="sidebarOverlay" class="sidebar-overlay"></div>

<!-- Bot√≥n hamburguesa para abrir/cerrar sidebar -->
<button id="toggleBtn" class="toggle-btn">‚ò∞</button>

<!-- Sidebar principal -->
<div id="sidebar" class="sidebar">
  <div class="top-section">
    <!-- Logo -->
    <a href="../Pages/inicio.html">
      <img src="../Assets/image/logo.png" alt="BiblioGest Logo" class="logo">
    </a>

    <!-- Men√∫ de navegaci√≥n -->
    <nav class="nav-links">
      <a href="../Pages/inicio.html">Inicio</a>
      <a href="../Pages/resenas.html">Rese√±as</a>

      <!-- Submen√∫ de Cat√°logo -->
      <div class="submenu">
        <a href="../Pages/directorio.html" class="submenu-toggle">Cat√°logo</a>
        <div class="submenu-links">
          <a href="../Pages/directorio.html">Libros</a>
          <a href="../Pages/mis-reservas.html">Mis reservas</a>
        </div>
      </div>

      <!-- Submen√∫ de Admin (solo visible para administradores) -->
      <div id="adminLink"  style="display: none;">
        <a href="../Pages/admin-dashboard.html">Panel Admin</a>
  
        </div>
    </nav>

    <!-- C√≠rculo de usuario para ir al perfil -->
    <div class="user-circle-container">
      <a href="../Pages/perfil.html">
        <div class="user-circle" title="Ver perfil"></div>
      </a>
    </div>
  </div>

  <!-- Bot√≥n de cerrar sesi√≥n -->
  <div class="logout-container">
    <button id="logoutBtn" class="logout-btn">Cerrar sesi√≥n</button>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Referencias a elementos del DOM
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('toggleBtn');
    const overlay = document.getElementById('sidebarOverlay');
    const logoutBtn = document.getElementById('logoutBtn');
    const adminLink = document.getElementById('adminLink');


    // VERIFICACI√ìN DE ROL DE USUARIO

    const usuario = JSON.parse(localStorage.getItem('usuario') || '{}');

    // Mostrar panel de admin solo si el usuario es administrador
    if (usuario.rol && usuario.rol.toUpperCase() === 'ADMIN') {
      adminLink.style.display = 'block';
    }


    // TOGGLE DEL SIDEBAR

    function toggleSidebar() {
      const isOpen = sidebar.classList.contains('open');

      if (isOpen) {
        // Cerrar sidebar
        sidebar.classList.remove('open');
        overlay.classList.remove('active');
        toggleBtn.innerHTML = '‚ò∞';
        document.body.style.overflow = 'auto';
      } else {
        // Abrir sidebar
        sidebar.classList.add('open');
        overlay.classList.add('active');
        toggleBtn.innerHTML = '‚úï';
        document.body.style.overflow = 'hidden';
      }
    }

    // Evento del bot√≥n toggle
    toggleBtn.addEventListener('click', toggleSidebar);

    // Cerrar sidebar al hacer click en el overlay
    overlay.addEventListener('click', toggleSidebar);

    // Cerrar sidebar en m√≥vil al hacer click en un link
    const navLinks = document.querySelectorAll('.nav-links a:not(.submenu-toggle)');
    navLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (window.innerWidth <= 768) {
          setTimeout(() => toggleSidebar(), 300);
        }
      });
    });

    // Cerrar sidebar al presionar ESC
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && sidebar.classList.contains('open')) {
        toggleSidebar();
      }
    });


    // FUNCIONALIDAD DE CERRAR SESI√ìN

    logoutBtn.addEventListener('click', function() {
      // Modal de confirmaci√≥n
      Swal.fire({
        title: 'üö™ ¬øCerrar sesi√≥n?',
        text: '¬øEst√°s seguro de que quieres cerrar tu sesi√≥n?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#ff3838',
        cancelButtonColor: '#5a6c7d',
        confirmButtonText: 'S√≠, cerrar sesi√≥n',
        cancelButtonText: 'Cancelar',
        background: '#2a3042',
        color: '#e4e6ea'
      }).then((result) => {
        if (result.isConfirmed) {
          // Limpiar datos del usuario
          localStorage.removeItem('usuario');

          // Mostrar mensaje de despedida
          Swal.fire({
            title: 'üëã ¬°Hasta luego!',
            text: 'Has cerrado sesi√≥n exitosamente',
            icon: 'success',
            background: '#2a3042',
            color: '#e4e6ea',
            timer: 2000,
            showConfirmButton: false
          }).then(() => {
            // Redirigir a la p√°gina de login (ruta absoluta)
            window.location.href = '/index.html';
          });
        }
      });
    });

    // ============================================
    // MARCAR LINK ACTIVO
    // ============================================
    function setActiveLink() {
      const currentPage = window.location.pathname.split('/').pop();
      const links = document.querySelectorAll('.nav-links a');

      links.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.includes(currentPage)) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
    }

    setActiveLink();


    // ESTILOS PERSONALIZADOS PARA SWEETALERT2

    const style = document.createElement('style');
    style.textContent = `
        .swal2-popup {
          background: #2a3042 !important;
          color: #e4e6ea !important;
          border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }
        .swal2-title {
          color: #ffffff !important;
        }
        .swal2-confirm {
          background: #4a90e2 !important;
        }
        .swal2-cancel {
          background: #5a6c7d !important;
        }
      `;
    document.head.appendChild(style);
  });
</script>

</body>
</html>